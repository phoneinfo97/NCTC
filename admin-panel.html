<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - NCTC</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      align-items: center;
      width: 100%;
    }

    .search-box input {
      flex: 3;
      min-width: 500px;
      padding: 12px 15px;
      font-size: 1.1em;
      border: 2px solid #c8e6c9;
      border-radius: 4px;
      transition: border-color 0.3s;
    }

    .search-box input:focus {
      border-color: #2e7d32;
      outline: none;
    }

    .search-box button {
      flex: 0.5;
      min-width: 120px;
      padding: 12px 25px;
      font-size: 1.1em;
      background: #2e7d32;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
      white-space: nowrap;
    }

    .search-box button:hover {
      background: #1b5e20;
    }

    /* Update existing search boxes */
    #search-student,
    #search-user,
    #search-result {
      min-width: 500px;
      padding: 12px 15px;
      font-size: 1.1em;
    }

    /* Make tables more responsive */
    .student-list,
    .user-list,
    .results-list {
      overflow-x: auto;
      margin-top: 20px;
    }

    table {
      width: 100%;
      min-width: 800px;
    }

    /* Improve table header styling */
    th {
      background: #2e7d32;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 500;
    }

    /* Improve table cell styling */
    td {
      padding: 12px 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    /* Improve button styling */
    .btn-small {
      padding: 8px 15px;
      margin: 0 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.3s;
    }

    .btn-small:not(.delete) {
      background: #2e7d32;
      color: white;
    }

    .btn-small:not(.delete):hover {
      background: #1b5e20;
    }

    .btn-small.delete {
      background: #d32f2f;
      color: white;
    }

    .btn-small.delete:hover {
      background: #b71c1c;
    }

    /* Exam Results Section Animations and Colors */
    #exam-results-section {
      animation: fadeIn 0.5s ease-in;
    }

    .form-section {
      background: linear-gradient(145deg, #ffffff, #f5f5f5);
      border: 1px solid #e0e0e0;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .form-section:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .admin-form input,
    .admin-form select,
    .admin-form textarea {
      transition: all 0.3s ease;
      border: 2px solid #e0e0e0;
    }

    .admin-form input:focus,
    .admin-form select:focus,
    .admin-form textarea:focus {
      border-color: #4caf50;
      box-shadow: 0 0 8px rgba(76, 175, 80, 0.2);
      transform: scale(1.02);
    }

    .admin-form button[type="submit"] {
      background: linear-gradient(45deg, #2e7d32, #4caf50);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .admin-form button[type="submit"]:hover {
      background: linear-gradient(45deg, #1b5e20, #2e7d32);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .admin-form button[type="submit"]:active {
      transform: translateY(0);
    }

    #results-table tr {
      transition: all 0.3s ease;
    }

    #results-table tr:hover {
      background-color: #e8f5e9;
      transform: scale(1.01);
    }

    .grade {
      animation: pulse 2s infinite;
    }

    .grade-A {
      background: linear-gradient(45deg, #2e7d32, #4caf50);
      color: white;
    }

    .grade-B {
      background: linear-gradient(45deg, #1976d2, #2196f3);
      color: white;
    }

    .grade-C {
      background: linear-gradient(45deg, #f57c00, #ff9800);
      color: white;
    }

    .grade-D {
      background: linear-gradient(45deg, #d32f2f, #f44336);
      color: white;
    }

    .grade-F {
      background: linear-gradient(45deg, #b71c1c, #d32f2f);
      color: white;
    }

    .btn-small {
      transition: all 0.3s ease;
    }

    .btn-small:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .btn-small:active {
      transform: translateY(0);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }

    /* Loading animation for results */
    .loading {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Form Fields Animations and Colors */
    .form-group {
      position: relative;
      margin-bottom: 20px;
      animation: slideIn 0.5s ease-out;
    }

    .form-group label {
      color: #2e7d32;
      font-weight: 600;
      display: block;
      margin-bottom: 8px;
      transform: translateY(0);
      transition: all 0.3s ease;
    }

    .form-group:hover label {
      transform: translateY(-2px);
      color: #1b5e20;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #c8e6c9;
      border-radius: 8px;
      font-size: 1.1em;
      background: white;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: #4caf50;
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
      transform: translateY(-2px);
    }

    .form-group select {
      appearance: none;
      background-image: linear-gradient(45deg, transparent 50%, #2e7d32 50%),
                        linear-gradient(135deg, #2e7d32 50%, transparent 50%);
      background-position: calc(100% - 20px) calc(1em + 2px),
                          calc(100% - 15px) calc(1em + 2px);
      background-size: 5px 5px,
                      5px 5px;
      background-repeat: no-repeat;
      cursor: pointer;
    }

    .form-group select:hover {
      background-color: #f5f5f5;
    }

    .form-group input[type="date"] {
      cursor: pointer;
    }

    .form-group input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(0.5) sepia(1) saturate(5) hue-rotate(100deg);
      cursor: pointer;
    }

    .form-group input[type="number"] {
      -moz-appearance: textfield;
    }

    .form-group input[type="number"]::-webkit-outer-spin-button,
    .form-group input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
      line-height: 1.5;
    }

    /* Grade Select Special Styling */
    #grade {
      background: linear-gradient(145deg, #ffffff, #f5f5f5);
    }

    #grade option {
      padding: 10px;
    }

    #grade option[value="A+"] { color: #2e7d32; }
    #grade option[value="A"] { color: #388e3c; }
    #grade option[value="B+"] { color: #1976d2; }
    #grade option[value="B"] { color: #2196f3; }
    #grade option[value="C+"] { color: #f57c00; }
    #grade option[value="C"] { color: #ff9800; }
    #grade option[value="D"] { color: #d32f2f; }
    #grade option[value="F"] { color: #b71c1c; }

    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .form-group:nth-child(1) { animation-delay: 0.1s; }
    .form-group:nth-child(2) { animation-delay: 0.2s; }
    .form-group:nth-child(3) { animation-delay: 0.3s; }
    .form-group:nth-child(4) { animation-delay: 0.4s; }
    .form-group:nth-child(5) { animation-delay: 0.5s; }
    .form-group:nth-child(6) { animation-delay: 0.6s; }
    .form-group:nth-child(7) { animation-delay: 0.7s; }
    .form-group:nth-child(8) { animation-delay: 0.8s; }

    /* Focus Effects */
    .form-group input:focus + label,
    .form-group select:focus + label,
    .form-group textarea:focus + label {
      color: #1b5e20;
      transform: translateY(-2px);
    }

    /* Hover Effects */
    .form-group:hover input,
    .form-group:hover select,
    .form-group:hover textarea {
      border-color: #81c784;
      box-shadow: 0 0 8px rgba(129, 199, 132, 0.2);
    }

    /* Logo Styles */
    .logo {
      display: flex;
      align-items: center;
    }

    .logo img {
      margin-right: 15px;
    }

    header .container {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    header h1 {
      margin: 0;
      font-size: 1.8em;
      color: #2e7d32;
    }

    .payment-history-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
      max-width: 800px;
      width: 90%;
    }

    .payment-history-modal table {
      width: 100%;
      margin: 20px 0;
    }

    .payment-history-modal th,
    .payment-history-modal td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .status-paid {
      color: #2e7d32;
      font-weight: bold;
    }

    .status-pending {
      color: #f57c00;
      font-weight: bold;
    }

    .status-partial {
      color: #1976d2;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="logo">
        <img src="logo.png" alt="NCTC Logo" height="50">
      </div>
      <h1>NCTC Admin Panel</h1>
      <nav>
        <ul>
          <li><a href="#" class="active" onclick="showSection('dashboard')">Dashboard</a></li>
          <li><a href="#" onclick="showSection('user-management')">User Management</a></li>
          <li><a href="#" onclick="showSection('exam-results')">Exam Results</a></li>
          <li><a href="#" onclick="showSection('payment-details')">Payment Details</a></li>
          <li><a href="notice-admin.html">Noticeboard</a></li>
          <li><a href="projects.html">Projects</a></li>
          <li><a href="#" id="logout-btn">Logout</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="container">
    <!-- Dashboard Section -->
    <div id="dashboard-section" class="admin-dashboard">
      <div class="admin-stats">
        <div class="stat-card">
          <h3>Total Students</h3>
          <p id="total-students">0</p>
        </div>
        <div class="stat-card">
          <h3>Total Courses</h3>
          <p id="total-courses">0</p>
        </div>
        <div class="stat-card">
          <h3>Today's Admissions</h3>
          <p id="today-admissions">0</p>
        </div>
      </div>

      <div class="admin-actions">
        <h2>Student Management</h2>
        <div class="search-box">
          <input type="text" id="search-student" placeholder="Search by name, roll number, or course">
          <button onclick="searchStudents()">Search</button>
        </div>
        
        <div class="student-list">
          <table id="students-table">
            <thead>
              <tr>
                <th>Roll Number</th>
                <th>Name</th>
                <th>Course</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Admission Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="students-list">
              <!-- Student data will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- User Management Section -->
    <div id="user-management-section" class="admin-dashboard" style="display: none;">
      <div class="admin-actions">
        <h2>User Account Management</h2>
        
        <!-- Create New User Account -->
        <div class="form-section">
          <h3>Create New User Account</h3>
          <form id="create-user-form" class="admin-form">
            <div class="form-group">
              <label for="student-roll">Student Roll Number</label>
              <input type="text" id="student-roll" required placeholder="Enter student roll number">
            </div>
            <div class="form-group">
              <label for="new-username">Username</label>
              <input type="text" id="new-username" required placeholder="Enter username">
            </div>
            <div class="form-group">
              <label for="new-password">Password</label>
              <input type="password" id="new-password" required placeholder="Enter password">
            </div>
            <button type="submit">Create Account</button>
          </form>
        </div>

        <!-- User Accounts List -->
        <div class="user-list-section">
          <h3>Existing User Accounts</h3>
          <div class="search-box">
            <input type="text" id="search-user" placeholder="Search by username or roll number">
            <button onclick="searchUsers()">Search</button>
          </div>
          
          <div class="user-list">
            <table id="users-table">
              <thead>
                <tr>
                  <th>Roll Number</th>
                  <th>Username</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="users-list">
                <!-- User accounts will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Exam Results Section -->
    <div id="exam-results-section" class="admin-dashboard" style="display: none;">
      <div class="admin-actions">
        <h2>Exam Results Management</h2>
        
        <!-- Add New Result -->
        <div class="form-section">
          <h3>Add New Result</h3>
          <form id="add-result-form" class="admin-form">
            <div class="form-group">
              <label for="student-roll-result">Student Roll Number</label>
              <input type="text" id="student-roll-result" required placeholder="Enter student roll number">
            </div>
            <div class="form-group">
              <label for="exam-name">Exam Name</label>
              <input type="text" id="exam-name" required placeholder="Enter exam name">
            </div>
            <div class="form-group">
              <label for="semester">Semester</label>
              <select id="semester" required>
                <option value="">Select Semester</option>
                <option value="First Semester">First Semester</option>
                <option value="Second Semester">Second Semester</option>
              </select>
            </div>
            <div class="form-group">
              <label for="exam-date">Exam Date</label>
              <input type="date" id="exam-date" required>
            </div>
            <div class="form-group">
              <label for="total-marks">Total Marks</label>
              <input type="number" id="total-marks" required min="0" placeholder="Enter total marks">
            </div>
            <div class="form-group">
              <label for="obtained-marks">Obtained Marks</label>
              <input type="number" id="obtained-marks" required min="0" placeholder="Enter obtained marks">
            </div>
            <div class="form-group">
              <label for="grade">Grade</label>
              <select id="grade" required>
                <option value="">Select Grade</option>
                <option value="A+">A+</option>
                <option value="A">A</option>
                <option value="B+">B+</option>
                <option value="B">B</option>
                <option value="C+">C+</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="F">F</option>
              </select>
            </div>
            <div class="form-group">
              <label for="remarks">Remarks</label>
              <textarea id="remarks" placeholder="Enter any remarks"></textarea>
            </div>
            <button type="submit">Add Result</button>
          </form>
        </div>

        <!-- Results List -->
        <div class="results-list-section">
          <h3>Exam Results List</h3>
          <div class="search-box">
            <input type="text" id="search-result" placeholder="Search by roll number or exam name">
            <button onclick="searchResults()">Search</button>
          </div>
          
          <div class="results-list">
            <table id="results-table">
              <thead>
                <tr>
                  <th>Roll Number</th>
                  <th>Student Name</th>
                  <th>Exam Name</th>
                  <th>Semester</th>
                  <th>Date</th>
                  <th>Marks</th>
                  <th>Grade</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="results-list">
                <!-- Results will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Details Section -->
    <div id="payment-details-section" class="admin-dashboard" style="display: none;">
      <div class="admin-actions">
        <h2>Payment Details</h2>
        <div class="search-box">
          <input type="text" id="search-payment" placeholder="Search by roll number or student name">
          <button onclick="searchPaymentDetails()">Search</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Roll Number</th>
                <th>Student Name</th>
                <th>Course</th>
                <th>Total Fees</th>
                <th>Paid Amount</th>
                <th>Due Amount</th>
                <th>Payment Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="payment-details-list">
              <!-- Payment details will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Noticeboard Control Section -->
    <div id="noticeboard-section" class="admin-dashboard" style="display: none;">
      <div class="admin-actions">
        <h2>Noticeboard Management</h2>
        
        <!-- Add New Notice -->
        <div class="form-section">
          <h3>Add New Notice</h3>
          <form id="add-notice-form" class="admin-form">
            <div class="form-group">
              <label for="notice-title">Notice Title</label>
              <input type="text" id="notice-title" required placeholder="Enter notice title">
            </div>
            <div class="form-group">
              <label for="notice-content">Notice Content</label>
              <textarea id="notice-content" required placeholder="Enter notice content" rows="4"></textarea>
            </div>
            <div class="form-group">
              <label for="notice-date">Notice Date</label>
              <input type="date" id="notice-date" required>
            </div>
            <div class="form-group">
              <label for="notice-status">Status</label>
              <select id="notice-status" required>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
              </select>
            </div>
            <button type="submit">Add Notice</button>
          </form>
        </div>

        <!-- Notices List -->
        <div class="notices-list-section">
          <h3>Manage Notices</h3>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="window.open('notice.html', '_blank')">View Notice Page</button>
          </div>
          <div class="search-box">
            <input type="text" id="search-notice" placeholder="Search by title">
            <button onclick="searchNotices()">Search</button>
          </div>
          
          <div class="notices-list">
            <table id="notices-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Title</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="notices-list">
                <!-- Notices will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Check if user is admin
    if (sessionStorage.getItem('isAdmin') !== 'true') {
      window.location.href = 'admin-login.html';
    }

    // Show/Hide Sections
    function showSection(sectionId) {
      document.getElementById('dashboard-section').style.display = sectionId === 'dashboard' ? 'block' : 'none';
      document.getElementById('user-management-section').style.display = sectionId === 'user-management' ? 'block' : 'none';
      document.getElementById('exam-results-section').style.display = sectionId === 'exam-results' ? 'block' : 'none';
      document.getElementById('payment-details-section').style.display = sectionId === 'payment-details' ? 'block' : 'none';
      document.getElementById('noticeboard-section').style.display = sectionId === 'noticeboard' ? 'block' : 'none';
      
      // Update active nav link
      document.querySelectorAll('nav a').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('onclick')?.includes(sectionId)) {
          link.classList.add('active');
        }
      });

      // Load section data
      if (sectionId === 'dashboard') {
        loadDashboard();
      } else if (sectionId === 'user-management') {
        loadUsersList();
      } else if (sectionId === 'exam-results') {
        loadResultsList();
      } else if (sectionId === 'payment-details') {
        loadPaymentDetails();
      } else if (sectionId === 'noticeboard') {
        loadNoticesList();
      }
    }

    // Load dashboard data
    function loadDashboard() {
      // Get students from localStorage
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      
      // Update statistics
      document.getElementById('total-students').textContent = students.length;
      document.getElementById('total-courses').textContent = courses.length;
      
      // Calculate today's admissions
      const today = new Date().toLocaleDateString();
      const todayAdmissions = students.filter(student => 
        new Date(student.admissionDate).toLocaleDateString() === today
      );
      document.getElementById('today-admissions').textContent = todayAdmissions.length;

      // Load students list
      loadStudentsList();
    }

    // Load students list
    function loadStudentsList() {
      const studentsList = document.getElementById('students-list');
      studentsList.innerHTML = '';

      const students = JSON.parse(localStorage.getItem('students') || '[]');
      
      // Sort students by admission date (newest first)
      students.sort((a, b) => new Date(b.admissionDate) - new Date(a.admissionDate));
      
      students.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.rollNumber}</td>
          <td>${student.fullName}</td>
          <td>${student.course}</td>
          <td>${student.email}</td>
          <td>${student.phone}</td>
          <td>${new Date(student.admissionDate).toLocaleDateString()}</td>
          <td>
            <button onclick="viewStudent('${student.rollNumber}')" class="btn-small">View</button>
            <button onclick="editStudent('${student.rollNumber}')" class="btn-small">Edit</button>
            <button onclick="deleteStudent('${student.rollNumber}')" class="btn-small delete">Delete</button>
          </td>
        `;
        studentsList.appendChild(row);
      });
    }

    // View student details
    function viewStudent(rollNumber) {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const student = students.find(s => s.rollNumber === rollNumber);
      
      if (student) {
        const details = `
          Student Details:
          Roll Number: ${student.rollNumber}
          Name: ${student.fullName}
          Course: ${student.course}
          Email: ${student.email}
          Phone: ${student.phone}
          Admission Date: ${new Date(student.admissionDate).toLocaleDateString()}
          Status: ${student.status || 'Active'}
        `;
        alert(details);
      }
    }

    // Edit student
    function editStudent(rollNumber) {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const student = students.find(s => s.rollNumber === rollNumber);
      
      if (student) {
        const newName = prompt('Enter new name:', student.fullName);
        if (newName === null) return;
        
        const newEmail = prompt('Enter new email:', student.email);
        if (newEmail === null) return;
        
        const newPhone = prompt('Enter new phone:', student.phone);
        if (newPhone === null) return;
        
        const newCourse = prompt('Enter new course:', student.course);
        if (newCourse === null) return;
        
        const newStatus = prompt('Enter new status (Active/Inactive):', student.status || 'Active');
        if (newStatus === null) return;

        // Update student data
        student.fullName = newName;
        student.email = newEmail;
        student.phone = newPhone;
        student.course = newCourse;
        student.status = newStatus;
        student.lastUpdated = new Date().toISOString();

        // Save updated data
        localStorage.setItem('students', JSON.stringify(students));
        
        // Reload the list
        loadStudentsList();
        alert('Student information updated successfully!');
      }
    }

    // Delete student
    function deleteStudent(rollNumber) {
      if (confirm('Are you sure you want to delete this student? This action cannot be undone.')) {
        const students = JSON.parse(localStorage.getItem('students') || '[]');
        const updatedStudents = students.filter(student => student.rollNumber !== rollNumber);
        localStorage.setItem('students', JSON.stringify(updatedStudents));
        
        // Also delete associated user account if exists
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const updatedUsers = users.filter(user => user.rollNumber !== rollNumber);
        localStorage.setItem('users', JSON.stringify(updatedUsers));
        
        loadStudentsList();
        alert('Student deleted successfully');
      }
    }

    // Search students
    function searchStudents() {
      const searchTerm = document.getElementById('search-student').value.toLowerCase();
      const studentsList = document.getElementById('students-list');
      studentsList.innerHTML = '';

      const students = JSON.parse(localStorage.getItem('students') || '[]');
      
      const filteredStudents = students.filter(student => 
        student.fullName.toLowerCase().includes(searchTerm) ||
        student.rollNumber.toLowerCase().includes(searchTerm) ||
        student.course.toLowerCase().includes(searchTerm) ||
        student.email.toLowerCase().includes(searchTerm) ||
        student.phone.toLowerCase().includes(searchTerm)
      );

      filteredStudents.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.rollNumber}</td>
          <td>${student.fullName}</td>
          <td>${student.course}</td>
          <td>${student.email}</td>
          <td>${student.phone}</td>
          <td>${new Date(student.admissionDate).toLocaleDateString()}</td>
          <td>
            <button onclick="viewStudent('${student.rollNumber}')" class="btn-small">View</button>
            <button onclick="editStudent('${student.rollNumber}')" class="btn-small">Edit</button>
            <button onclick="deleteStudent('${student.rollNumber}')" class="btn-small delete">Delete</button>
          </td>
        `;
        studentsList.appendChild(row);
      });
    }

    // User Management Functions
    function loadUsersList() {
      const usersList = document.getElementById('users-list');
      usersList.innerHTML = '';

      const users = JSON.parse(localStorage.getItem('users') || '[]');
      
      users.forEach(user => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user.rollNumber}</td>
          <td>${user.username}</td>
          <td>${user.status || 'Active'}</td>
          <td>
            <button onclick="resetUserPassword('${user.rollNumber}')" class="btn-small">Reset Password</button>
            <button onclick="deleteUser('${user.rollNumber}')" class="btn-small delete">Delete</button>
          </td>
        `;
        usersList.appendChild(row);
      });
    }

    // Create new user account
    document.getElementById('create-user-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const rollNumber = document.getElementById('student-roll').value;
      const username = document.getElementById('new-username').value;
      const password = document.getElementById('new-password').value;

      // Check if student exists
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const student = students.find(s => s.rollNumber === rollNumber);
      
      if (!student) {
        alert('Student with this roll number does not exist!');
        return;
      }

      // Check if username already exists
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      if (users.some(u => u.username === username)) {
        alert('Username already exists!');
        return;
      }

      // Check if user account already exists for this roll number
      if (users.some(u => u.rollNumber === rollNumber)) {
        alert('User account already exists for this student!');
        return;
      }

      // Create new user account
      users.push({
        rollNumber,
        username,
        password,
        status: 'Active',
        createdAt: new Date().toISOString()
      });

      localStorage.setItem('users', JSON.stringify(users));
      
      // Clear form
      document.getElementById('create-user-form').reset();
      
      // Reload users list
      loadUsersList();
      
      alert('User account created successfully!');
    });

    // Search users
    function searchUsers() {
      const searchTerm = document.getElementById('search-user').value.toLowerCase();
      const usersList = document.getElementById('users-list');
      usersList.innerHTML = '';

      const users = JSON.parse(localStorage.getItem('users') || '[]');
      
      const filteredUsers = users.filter(user => 
        user.username.toLowerCase().includes(searchTerm) ||
        user.rollNumber.toLowerCase().includes(searchTerm)
      );

      filteredUsers.forEach(user => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user.rollNumber}</td>
          <td>${user.username}</td>
          <td>${user.status || 'Active'}</td>
          <td>
            <button onclick="resetUserPassword('${user.rollNumber}')" class="btn-small">Reset Password</button>
            <button onclick="deleteUser('${user.rollNumber}')" class="btn-small delete">Delete</button>
          </td>
        `;
        usersList.appendChild(row);
      });
    }

    // Reset user password
    function resetUserPassword(rollNumber) {
      const newPassword = prompt('Enter new password:');
      if (newPassword) {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const userIndex = users.findIndex(u => u.rollNumber === rollNumber);
        
        if (userIndex !== -1) {
          users[userIndex].password = newPassword;
          localStorage.setItem('users', JSON.stringify(users));
          alert('Password reset successfully!');
        }
      }
    }

    // Delete user account
    function deleteUser(rollNumber) {
      if (confirm('Are you sure you want to delete this user account?')) {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const updatedUsers = users.filter(user => user.rollNumber !== rollNumber);
        localStorage.setItem('users', JSON.stringify(updatedUsers));
        loadUsersList();
        alert('User account deleted successfully');
      }
    }

    // Exam Results Functions
    function loadResultsList() {
      const resultsList = document.getElementById('results-list');
      resultsList.innerHTML = '';

      const results = JSON.parse(localStorage.getItem('examResults') || '[]');
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      
      results.forEach(result => {
        const student = students.find(s => s.rollNumber === result.rollNumber);
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${result.rollNumber}</td>
          <td>${student ? student.fullName : 'N/A'}</td>
          <td>${result.examName}</td>
          <td>${result.semester}</td>
          <td>${new Date(result.examDate).toLocaleDateString()}</td>
          <td>${result.obtainedMarks}/${result.totalMarks}</td>
          <td>${result.grade}</td>
          <td>
            <button onclick="viewResult('${result.id}')" class="btn-small">View</button>
            <button onclick="editResult('${result.id}')" class="btn-small">Edit</button>
            <button onclick="deleteResult('${result.id}')" class="btn-small delete">Delete</button>
          </td>
        `;
        resultsList.appendChild(row);
      });
    }

    // Add new result
    document.getElementById('add-result-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const rollNumber = document.getElementById('student-roll-result').value;
      const examName = document.getElementById('exam-name').value;
      const semester = document.getElementById('semester').value;
      const examDate = document.getElementById('exam-date').value;
      const totalMarks = document.getElementById('total-marks').value;
      const obtainedMarks = document.getElementById('obtained-marks').value;
      const grade = document.getElementById('grade').value;
      const remarks = document.getElementById('remarks').value;

      // Check if student exists
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const student = students.find(s => s.rollNumber === rollNumber);
      
      if (!student) {
        alert('Student with this roll number does not exist!');
        return;
      }

      // Create new result
      const results = JSON.parse(localStorage.getItem('examResults') || '[]');
      const newResult = {
        id: Date.now().toString(),
        rollNumber,
        examName,
        semester,
        examDate,
        totalMarks: parseInt(totalMarks),
        obtainedMarks: parseInt(obtainedMarks),
        grade,
        remarks,
        createdAt: new Date().toISOString()
      };

      results.push(newResult);
      localStorage.setItem('examResults', JSON.stringify(results));
      
      // Clear form
      document.getElementById('add-result-form').reset();
      
      // Reload results list
      loadResultsList();
      
      alert('Result added successfully!');
    });

    // Search results
    function searchResults() {
      const searchTerm = document.getElementById('search-result').value.toLowerCase();
      const resultsList = document.getElementById('results-list');
      resultsList.innerHTML = '';

      const results = JSON.parse(localStorage.getItem('examResults') || '[]');
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      
      const filteredResults = results.filter(result => 
        result.rollNumber.toLowerCase().includes(searchTerm) ||
        result.examName.toLowerCase().includes(searchTerm)
      );

      filteredResults.forEach(result => {
        const student = students.find(s => s.rollNumber === result.rollNumber);
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${result.rollNumber}</td>
          <td>${student ? student.fullName : 'N/A'}</td>
          <td>${result.examName}</td>
          <td>${result.semester}</td>
          <td>${new Date(result.examDate).toLocaleDateString()}</td>
          <td>${result.obtainedMarks}/${result.totalMarks}</td>
          <td>${result.grade}</td>
          <td>
            <button onclick="viewResult('${result.id}')" class="btn-small">View</button>
            <button onclick="editResult('${result.id}')" class="btn-small">Edit</button>
            <button onclick="deleteResult('${result.id}')" class="btn-small delete">Delete</button>
          </td>
        `;
        resultsList.appendChild(row);
      });
    }

    // View result details
    function viewResult(resultId) {
      const results = JSON.parse(localStorage.getItem('examResults') || '[]');
      const result = results.find(r => r.id === resultId);
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const student = students.find(s => s.rollNumber === result.rollNumber);
      
      if (result) {
        const details = `
          Result Details:
          Student: ${student ? student.fullName : 'N/A'} (${result.rollNumber})
          Exam: ${result.examName}
          Semester: ${result.semester}
          Date: ${new Date(result.examDate).toLocaleDateString()}
          Marks: ${result.obtainedMarks}/${result.totalMarks}
          Grade: ${result.grade}
          Remarks: ${result.remarks || 'None'}
        `;
        alert(details);
      }
    }

    // Edit result
    function editResult(resultId) {
      const results = JSON.parse(localStorage.getItem('examResults') || '[]');
      const result = results.find(r => r.id === resultId);
      
      if (result) {
        const newSemester = prompt('Enter new semester:', result.semester);
        if (newSemester === null) return;
        
        const newMarks = prompt('Enter new obtained marks:', result.obtainedMarks);
        if (newMarks === null) return;
        
        const newGrade = prompt('Enter new grade:', result.grade);
        if (newGrade === null) return;
        
        const newRemarks = prompt('Enter new remarks:', result.remarks);
        if (newRemarks === null) return;

        // Update result data
        result.semester = newSemester;
        result.obtainedMarks = parseInt(newMarks);
        result.grade = newGrade;
        result.remarks = newRemarks;
        result.updatedAt = new Date().toISOString();

        // Save updated data
        localStorage.setItem('examResults', JSON.stringify(results));
        
        // Reload the list
        loadResultsList();
        alert('Result updated successfully!');
      }
    }

    // Delete result
    function deleteResult(resultId) {
      if (confirm('Are you sure you want to delete this result?')) {
        const results = JSON.parse(localStorage.getItem('examResults') || '[]');
        const updatedResults = results.filter(result => result.id !== resultId);
        localStorage.setItem('examResults', JSON.stringify(updatedResults));
        loadResultsList();
        alert('Result deleted successfully');
      }
    }

    // Logout
    document.getElementById('logout-btn').addEventListener('click', (e) => {
      e.preventDefault();
      sessionStorage.removeItem('isAdmin');
      window.location.href = 'admin-login.html';
    });

    // Load dashboard on page load
    loadDashboard();

    // Function to generate roll number
    function generateRollNumber() {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      let lastRollNumber = 10000; // Start from 10000

      // Find the highest roll number
      students.forEach(student => {
        const rollNum = parseInt(student.rollNumber.split('/')[1]);
        if (rollNum > lastRollNumber) {
          lastRollNumber = rollNum;
        }
      });

      // Generate next roll number
      const nextRollNumber = lastRollNumber + 1;
      return `NCTC/${nextRollNumber}`;
    }

    // Update the admission form to use the new roll number
    document.getElementById('add-student-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const rollNumber = generateRollNumber();
      const fullName = document.getElementById('full-name').value;
      const course = document.getElementById('course').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const admissionDate = new Date().toISOString();

      // Create new student
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      students.push({
        rollNumber,
        fullName,
        course,
        email,
        phone,
        admissionDate,
        status: 'Active'
      });

      localStorage.setItem('students', JSON.stringify(students));
      
      // Clear form
      document.getElementById('add-student-form').reset();
      
      // Reload students list
      loadStudentsList();
      
      alert(`Student admitted successfully! Roll Number: ${rollNumber}`);
    });

    // Load payment details
    function loadPaymentDetails() {
      const paymentDetailsList = document.getElementById('payment-details-list');
      paymentDetailsList.innerHTML = '';

      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const payments = JSON.parse(localStorage.getItem('payments') || '[]');
      const allFeeSettings = JSON.parse(localStorage.getItem('feeSettings') || '{}');

      students.forEach(student => {
        // Get course fee settings
        const courseSettings = allFeeSettings[student.course] || {
          admissionFee: 790,
          registrationFee: 660,
          examFee: 600,
          resultFee: 600,
          discountPercentage: 20
        };

        // Calculate total fees
        const totalFees = courseSettings.admissionFee + courseSettings.registrationFee + 
                         courseSettings.examFee + courseSettings.resultFee;

        // Calculate paid amount
        const studentPayments = payments.filter(p => p.rollNumber === student.rollNumber);
        const paidAmount = studentPayments.reduce((sum, payment) => sum + payment.amount, 0);

        // Calculate due amount
        const dueAmount = totalFees - paidAmount;

        // Determine payment status
        let paymentStatus = 'Pending';
        if (paidAmount >= totalFees) {
          paymentStatus = 'Paid';
        } else if (paidAmount > 0) {
          paymentStatus = 'Partial';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.rollNumber}</td>
          <td>${student.fullName}</td>
          <td>${student.course}</td>
          <td>₹${totalFees}</td>
          <td>₹${paidAmount}</td>
          <td>₹${dueAmount}</td>
          <td class="status-${paymentStatus.toLowerCase()}">${paymentStatus}</td>
          <td>
            <button onclick="viewPaymentHistory('${student.rollNumber}')" class="btn-small">View History</button>
            <button onclick="addPayment('${student.rollNumber}')" class="btn-small">Add Payment</button>
          </td>
        `;
        paymentDetailsList.appendChild(row);
      });
    }

    // Search payment details
    function searchPaymentDetails() {
      const searchTerm = document.getElementById('search-payment').value.toLowerCase();
      const paymentDetailsList = document.getElementById('payment-details-list');
      paymentDetailsList.innerHTML = '';

      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const payments = JSON.parse(localStorage.getItem('payments') || '[]');
      const allFeeSettings = JSON.parse(localStorage.getItem('feeSettings') || '{}');

      const filteredStudents = students.filter(student => 
        student.rollNumber.toLowerCase().includes(searchTerm) ||
        student.fullName.toLowerCase().includes(searchTerm)
      );

      filteredStudents.forEach(student => {
        // Get course fee settings
        const courseSettings = allFeeSettings[student.course] || {
          admissionFee: 790,
          registrationFee: 660,
          examFee: 600,
          resultFee: 600,
          discountPercentage: 20
        };

        // Calculate total fees
        const totalFees = courseSettings.admissionFee + courseSettings.registrationFee + 
                         courseSettings.examFee + courseSettings.resultFee;

        // Calculate paid amount
        const studentPayments = payments.filter(p => p.rollNumber === student.rollNumber);
        const paidAmount = studentPayments.reduce((sum, payment) => sum + payment.amount, 0);

        // Calculate due amount
        const dueAmount = totalFees - paidAmount;

        // Determine payment status
        let paymentStatus = 'Pending';
        if (paidAmount >= totalFees) {
          paymentStatus = 'Paid';
        } else if (paidAmount > 0) {
          paymentStatus = 'Partial';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.rollNumber}</td>
          <td>${student.fullName}</td>
          <td>${student.course}</td>
          <td>₹${totalFees}</td>
          <td>₹${paidAmount}</td>
          <td>₹${dueAmount}</td>
          <td class="status-${paymentStatus.toLowerCase()}">${paymentStatus}</td>
          <td>
            <button onclick="viewPaymentHistory('${student.rollNumber}')" class="btn-small">View History</button>
            <button onclick="addPayment('${student.rollNumber}')" class="btn-small">Add Payment</button>
          </td>
        `;
        paymentDetailsList.appendChild(row);
      });
    }

    // View payment history
    function viewPaymentHistory(rollNumber) {
      window.location.href = `payment-details.html?roll=${rollNumber}`;
    }

    // Add payment
    function addPayment(rollNumber) {
      window.location.href = `payment.html?roll=${rollNumber}`;
    }

    // Noticeboard Functions
    function loadNoticesList() {
      const noticesList = document.getElementById('notices-list');
      noticesList.innerHTML = '';

      try {
        const notices = JSON.parse(localStorage.getItem('notices') || '[]');
        
        // Sort notices by date (newest first)
        notices.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        if (notices.length === 0) {
          noticesList.innerHTML = '<tr><td colspan="4" style="text-align: center;">No notices available</td></tr>';
          return;
        }
        
        notices.forEach(notice => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${new Date(notice.date).toLocaleDateString()}</td>
            <td>${notice.title}</td>
            <td class="status-${notice.status.toLowerCase()}">${notice.status}</td>
            <td>
              <button onclick="viewNotice('${notice.id}')" class="btn-small">View</button>
              <button onclick="editNotice('${notice.id}')" class="btn-small">Edit</button>
              <button onclick="previewNotice('${notice.id}')" class="btn-small">Preview</button>
              <button onclick="deleteNotice('${notice.id}')" class="btn-small delete">Delete</button>
            </td>
          `;
          noticesList.appendChild(row);
        });
      } catch (error) {
        console.error('Error loading notices:', error);
        noticesList.innerHTML = '<tr><td colspan="4" style="text-align: center;">Error loading notices</td></tr>';
      }
    }

    // Add new notice
    document.getElementById('add-notice-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const title = document.getElementById('notice-title').value.trim();
      const content = document.getElementById('notice-content').value.trim();
      const date = document.getElementById('notice-date').value;
      const status = document.getElementById('notice-status').value;

      // Validate inputs
      if (!title || !content || !date) {
        alert('Please fill in all required fields');
        return;
      }

      try {
        // Get existing notices
        let notices = JSON.parse(localStorage.getItem('notices') || '[]');
        
        // Create new notice
        const newNotice = {
          id: Date.now().toString(),
          title: title,
          content: content,
          date: date,
          status: status,
          createdAt: new Date().toISOString()
        };

        // Add to notices array
        notices.push(newNotice);
        
        // Save to localStorage
        localStorage.setItem('notices', JSON.stringify(notices));
        
        // Clear form
        document.getElementById('add-notice-form').reset();
        
        // Reload notices list
        loadNoticesList();
        
        // Show success message
        alert('Notice added successfully!');
        
        // Update notice page
        updateNoticePage();
      } catch (error) {
        console.error('Error saving notice:', error);
        alert('Error saving notice. Please try again.');
      }
    });

    // Update notice page
    function updateNoticePage() {
      try {
        // Save current notices to temporary storage
        const notices = JSON.parse(localStorage.getItem('notices') || '[]');
        sessionStorage.setItem('tempNotices', JSON.stringify(notices));
        
        // Open notice page in new tab
        window.open('notice.html', '_blank');
      } catch (error) {
        console.error('Error updating notice page:', error);
      }
    }

    // Edit notice
    function editNotice(noticeId) {
      try {
        const notices = JSON.parse(localStorage.getItem('notices') || '[]');
        const notice = notices.find(n => n.id === noticeId);
        
        if (notice) {
          const newTitle = prompt('Enter new title:', notice.title);
          if (newTitle === null) return;
          
          const newContent = prompt('Enter new content:', notice.content);
          if (newContent === null) return;
          
          const newStatus = prompt('Enter new status (Active/Inactive):', notice.status);
          if (newStatus === null) return;

          // Update notice data
          notice.title = newTitle.trim();
          notice.content = newContent.trim();
          notice.status = newStatus;
          notice.updatedAt = new Date().toISOString();

          // Save updated data
          localStorage.setItem('notices', JSON.stringify(notices));
          
          // Reload the list
          loadNoticesList();
          
          // Update notice page
          updateNoticePage();
          
          alert('Notice updated successfully!');
        }
      } catch (error) {
        console.error('Error editing notice:', error);
        alert('Error editing notice. Please try again.');
      }
    }

    // Delete notice
    function deleteNotice(noticeId) {
      if (confirm('Are you sure you want to delete this notice?')) {
        try {
          const notices = JSON.parse(localStorage.getItem('notices') || '[]');
          const updatedNotices = notices.filter(notice => notice.id !== noticeId);
          localStorage.setItem('notices', JSON.stringify(updatedNotices));
          loadNoticesList();
          updateNoticePage();
          alert('Notice deleted successfully');
        } catch (error) {
          console.error('Error deleting notice:', error);
          alert('Error deleting notice. Please try again.');
        }
      }
    }

    // Search notices
    function searchNotices() {
      const searchTerm = document.getElementById('search-notice').value.toLowerCase();
      const noticesList = document.getElementById('notices-list');
      noticesList.innerHTML = '';

      const notices = JSON.parse(localStorage.getItem('notices') || '[]');
      
      const filteredNotices = notices.filter(notice => 
        notice.title.toLowerCase().includes(searchTerm)
      );

      filteredNotices.forEach(notice => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${new Date(notice.date).toLocaleDateString()}</td>
          <td>${notice.title}</td>
          <td class="status-${notice.status.toLowerCase()}">${notice.status}</td>
          <td>
            <button onclick="viewNotice('${notice.id}')" class="btn-small">View</button>
            <button onclick="editNotice('${notice.id}')" class="btn-small">Edit</button>
            <button onclick="previewNotice('${notice.id}')" class="btn-small">Preview</button>
            <button onclick="deleteNotice('${notice.id}')" class="btn-small delete">Delete</button>
          </td>
        `;
        noticesList.appendChild(row);
      });
    }

    // View notice
    function viewNotice(noticeId) {
      try {
        const notices = JSON.parse(localStorage.getItem('notices') || '[]');
        const notice = notices.find(n => n.id === noticeId);
        
        if (notice) {
          const details = `
            Notice Details:
            Title: ${notice.title}
            Date: ${new Date(notice.date).toLocaleDateString()}
            Status: ${notice.status}
            Content: ${notice.content}
          `;
          alert(details);
        }
      } catch (error) {
        console.error('Error viewing notice:', error);
        alert('Error viewing notice. Please try again.');
      }
    }
  </script>
</body>
</html> 